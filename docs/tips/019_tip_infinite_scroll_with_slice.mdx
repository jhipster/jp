---
<<<<<<< HEAD:tips/019_tip_infinite_scroll_with_slice.md
layout: default
title: Sliceで無限スクロールのパフォーマンスを向上
sitemap:
priority: 0.5
lastmod: 2016-11-12T22:22:00-00:00
---

# Sliceを使用した無限スクロールによるページ区切りのパフォーマンスの向上

__このTipは[@nkolosnjaji](https://github.com/nkolosnjaji)により提出されました__

無限スクロールのページ区切りでは、Spring Data Pageを使用してデータベースからエンティティを取得します。
これにより、2つのクエリーがトリガーされます。1つはエンティティをフェッチするためのクエリーで、2つ目はページングするアイテムの合計を決定するための`count all`クエリーです。無限スクロールには合計サイズに関する情報は必要ありませんが、ロードする次のページがある場合にのみ必要です。大規模なデータセットで作業する場合にコストのかかる`count all`クエリーを回避するには、無限スクロールのパフォーマンスを向上させるPageの代わりに[Slice](http://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/Slice.html)を使用します。
=======
title: Boost infinite scroll performance with Slice
slug: /tips/019_tip_infinite_scroll_with_slice.html
last_update:
  date: 2016-11-12T22:22:00-00:00
---

__Tip submitted by [@nkolosnjaji](https://github.com/nkolosnjaji)__


## Boost performance of pagination with infinite scrolling using Slice

Pagination with infinite scrolling is using Spring Data Page to retrieve entities from your database.
This will trigger two queries, one to fetch entities and second for `count all` to determine the total items for paging. Infinite scrolling doesn't need information about the total size but only if there is a next page to load. To avoid `count all` query which can be an expensive operation when working with large datasets, use [Slice](http://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/Slice.html) instead of Page which will boost performance of infinite scrolling.
>>>>>>> be9dc09c024a35e21e9637afdb55a6d53991f8d2:docs/tips/019_tip_infinite_scroll_with_slice.mdx

フロントエンドの無限スクロールプラグインに情報を送信するために、カスタムHTTPヘッダ`X-Has-Next-Page`を使用します。

<<<<<<< HEAD:tips/019_tip_infinite_scroll_with_slice.md
  * エンティティリポジトリに新しいメソッドを定義します。
=======
* Define new method in your Entity repository:
>>>>>>> be9dc09c024a35e21e9637afdb55a6d53991f8d2:docs/tips/019_tip_infinite_scroll_with_slice.mdx

```java
Slice<YourEntity> findSliceBy(Pageable pageable);
```

<<<<<<< HEAD:tips/019_tip_infinite_scroll_with_slice.md
  * `web/rest/util`パッケージにある`PaginationUtil.java`に新しい静的メソッドを定義します。
=======
* Define new static method in `PaginationUtil.java` located in `web/rest/util` package
>>>>>>> be9dc09c024a35e21e9637afdb55a6d53991f8d2:docs/tips/019_tip_infinite_scroll_with_slice.mdx

```java
public static HttpHeaders generateSliceHttpHeaders(Slice<?> slice) {
  HttpHeaders headers = new HttpHeaders();
  headers.add("X-Has-Next-Page", "" + slice.hasNext());
  return headers;
}
```

<<<<<<< HEAD:tips/019_tip_infinite_scroll_with_slice.md
  * RESTコントローラーを変更して、Pageの代わりにSliceを呼び出し、新しいHTTPヘッダーを生成するようにします。
=======
* Modify REST controller to call Slice instead of Page and generate new HTTP headers.
>>>>>>> be9dc09c024a35e21e9637afdb55a6d53991f8d2:docs/tips/019_tip_infinite_scroll_with_slice.mdx

```java
@GetMapping("/<YourEntities>")
@Timed
public ResponseEntity<List<Repo>> getAllRepos(Pageable pageable)
    throws URISyntaxException {
    Slice<YourEntity> slice = repoRepository.findSliceBy(pageable);
    HttpHeaders headers = PaginationUtil.generateSliceHttpHeaders(slice);
    return new ResponseEntity<>(slice.getContent(), headers, HttpStatus.OK);
}
```

<<<<<<< HEAD:tips/019_tip_infinite_scroll_with_slice.md
  * 新しいビューモデルを`entity.controller.js`で定義します。
=======
* Define new view model in `entity.controller.js`
>>>>>>> be9dc09c024a35e21e9637afdb55a6d53991f8d2:docs/tips/019_tip_infinite_scroll_with_slice.mdx

```js
vm.hasNextPage = false;
```

<<<<<<< HEAD:tips/019_tip_infinite_scroll_with_slice.md
  * 応答からHTTPヘッダー値を抽出し、それをビューモデルに割り当てます。
=======
* Extract HTTP header value from response and assign it to view model in
>>>>>>> be9dc09c024a35e21e9637afdb55a6d53991f8d2:docs/tips/019_tip_infinite_scroll_with_slice.mdx

```js
function onSuccess(data, headers) {
    vm.hasNextPage = headers('X-Has-Next-Page') === "true";
    ...
}
```

<<<<<<< HEAD:tips/019_tip_infinite_scroll_with_slice.md
  * `<your-entities>.html`で無限スクロールプラグインを使ったビューモデルを使用します。
=======
* Use view model with infinite-scroll plugin in `<your-entities>.html`
>>>>>>> be9dc09c024a35e21e9637afdb55a6d53991f8d2:docs/tips/019_tip_infinite_scroll_with_slice.mdx

```html
<tbody infinite-scroll="vm.loadPage(vm.page + 1)" infinite-scroll-disabled="!vm.hasNextPage">
```
